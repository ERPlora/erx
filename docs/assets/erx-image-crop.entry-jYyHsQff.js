import{r as m,c as x,g,h as r}from"./index-DLMfuaWg.js";const u=()=>":host{display:block;font-family:-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif}.erx-crop{display:flex;flex-direction:column;gap:16px}.erx-crop__container{position:relative;width:100%;aspect-ratio:4/3;background:#111;border-radius:8px;overflow:hidden}.erx-crop__image{position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);max-width:100%;max-height:100%;-o-object-fit:contain;object-fit:contain;transition:transform 200ms ease;-webkit-user-select:none;-moz-user-select:none;user-select:none;pointer-events:none}.erx-crop__overlay{position:absolute;inset:0}.erx-crop__area{position:absolute;border:2px solid white;box-shadow:0 0 0 9999px rgba(0,0,0,0.5);cursor:move}.erx-crop__area--circular{border-radius:50%}.erx-crop__grid{position:absolute;inset:0;pointer-events:none}.erx-crop__grid-line{position:absolute;background:rgba(255,255,255,0.3)}.erx-crop__grid-line--h1{left:0;right:0;top:33.33%;height:1px}.erx-crop__grid-line--h2{left:0;right:0;top:66.66%;height:1px}.erx-crop__grid-line--v1{top:0;bottom:0;left:33.33%;width:1px}.erx-crop__grid-line--v2{top:0;bottom:0;left:66.66%;width:1px}.erx-crop__handle{position:absolute;width:12px;height:12px;background:white;border-radius:2px}.erx-crop__handle--nw{top:-6px;left:-6px;cursor:nw-resize}.erx-crop__handle--ne{top:-6px;right:-6px;cursor:ne-resize}.erx-crop__handle--sw{bottom:-6px;left:-6px;cursor:sw-resize}.erx-crop__handle--se{bottom:-6px;right:-6px;cursor:se-resize}.erx-crop__controls{display:flex;align-items:center;justify-content:center;gap:16px;padding:12px;background:var(--erx-surface-secondary, #f9fafb);border-radius:8px}.erx-crop__zoom{display:flex;align-items:center;gap:8px}.erx-crop__zoom span{font-size:14px;color:var(--erx-text-secondary, #6b7280);min-width:40px}.erx-crop__zoom-slider{width:120px;cursor:pointer}.erx-crop__rotation{display:flex;gap:4px}.erx-crop__btn{padding:8px 12px;border:1px solid var(--erx-border-color, #e5e7eb);border-radius:6px;background:var(--erx-surface, #fff);font-size:14px;color:var(--erx-text, #111827);cursor:pointer;transition:all 150ms ease}.erx-crop__btn:hover{background:var(--erx-surface-secondary, #f9fafb)}@media (prefers-color-scheme: dark){:host{color-scheme:dark}}:host-context(.dark) .erx-crop__controls,:host(.dark) .erx-crop__controls{background:var(--erx-surface-secondary)}:host-context(.dark) .erx-crop__btn,:host(.dark) .erx-crop__btn{background:var(--erx-surface);border-color:var(--erx-border-color);color:var(--erx-text)}",b=class{constructor(e){m(this,e),this.erxCropChange=x(this,"erxCropChange"),this.erxCropComplete=x(this,"erxCropComplete")}get el(){return g(this)}src;aspectRatio;minWidth=50;minHeight=50;showGrid=!0;circular=!1;minZoom=1;maxZoom=3;outputFormat="jpeg";outputQuality=.9;erxCropChange;erxCropComplete;zoom=1;rotation=0;cropArea={x:25,y:25,width:50,height:50};isDragging=!1;isResizing=!1;imageLoaded=!1;containerEl;imageEl;startX=0;startY=0;startCrop={x:0,y:0,width:0,height:0};async getCroppedImage(){return new Promise(e=>{if(!this.imageEl)throw new Error("No image loaded");const a=document.createElement("canvas"),i=a.getContext("2d"),p=this.imageEl.naturalWidth,o=this.imageEl.naturalHeight,s=this.cropArea.x/100*p,l=this.cropArea.y/100*o,c=this.cropArea.width/100*p,n=this.cropArea.height/100*o;a.width=c,a.height=n,this.circular&&(i.beginPath(),i.arc(c/2,n/2,Math.min(c,n)/2,0,Math.PI*2),i.closePath(),i.clip()),i.drawImage(this.imageEl,s,l,c,n,0,0,c,n),a.toBlob(h=>{const t={dataUrl:a.toDataURL(`image/${this.outputFormat}`,this.outputQuality),blob:h,cropArea:{x:s,y:l,width:c,height:n}};this.erxCropComplete.emit(t),e(t)},`image/${this.outputFormat}`,this.outputQuality)})}async setZoom(e){this.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,e))}async rotate(e){this.rotation=(this.rotation+e)%360}async reset(){this.zoom=1,this.rotation=0,this.cropArea={x:25,y:25,width:50,height:50}}handleMouseDown=e=>{e.preventDefault(),this.isDragging=!0,this.startX=e.clientX,this.startY=e.clientY,this.startCrop={...this.cropArea},document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("mouseup",this.handleMouseUp)};handleMouseMove=e=>{if(!this.isDragging||!this.containerEl)return;const a=this.containerEl.getBoundingClientRect(),i=(e.clientX-this.startX)/a.width*100,p=(e.clientY-this.startY)/a.height*100;let o=this.startCrop.x+i,s=this.startCrop.y+p;o=Math.max(0,Math.min(100-this.cropArea.width,o)),s=Math.max(0,Math.min(100-this.cropArea.height,s)),this.cropArea={...this.cropArea,x:o,y:s},this.emitCropChange()};handleMouseUp=()=>{this.isDragging=!1,document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp)};handleResize=(e,a)=>{a.preventDefault(),a.stopPropagation(),this.isResizing=!0;const i=a.clientX,p=a.clientY,o={...this.cropArea},s=c=>{if(!this.containerEl)return;const n=this.containerEl.getBoundingClientRect(),h=(c.clientX-i)/n.width*100,d=(c.clientY-p)/n.height*100;let t={...o};switch(e){case"se":t.width=Math.max(10,o.width+h),t.height=this.aspectRatio?t.width/this.aspectRatio:Math.max(10,o.height+d);break;case"sw":t.x=o.x+h,t.width=Math.max(10,o.width-h),t.height=this.aspectRatio?t.width/this.aspectRatio:Math.max(10,o.height+d);break;case"ne":t.y=o.y+d,t.width=Math.max(10,o.width+h),t.height=this.aspectRatio?t.width/this.aspectRatio:Math.max(10,o.height-d);break;case"nw":t.x=o.x+h,t.y=o.y+d,t.width=Math.max(10,o.width-h),t.height=this.aspectRatio?t.width/this.aspectRatio:Math.max(10,o.height-d);break}t.x=Math.max(0,Math.min(100-t.width,t.x)),t.y=Math.max(0,Math.min(100-t.height,t.y)),t.width=Math.min(100-t.x,t.width),t.height=Math.min(100-t.y,t.height),this.cropArea=t,this.emitCropChange()},l=()=>{this.isResizing=!1,document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",l)};document.addEventListener("mousemove",s),document.addEventListener("mouseup",l)};emitCropChange(){if(!this.imageEl)return;const e=this.imageEl.naturalWidth,a=this.imageEl.naturalHeight;this.erxCropChange.emit({cropArea:this.cropArea,cropAreaPixels:{x:this.cropArea.x/100*e,y:this.cropArea.y/100*a,width:this.cropArea.width/100*e,height:this.cropArea.height/100*a},zoom:this.zoom,rotation:this.rotation})}handleZoomChange=e=>{this.zoom=parseFloat(e.target.value),this.emitCropChange()};render(){return r("div",{key:"cbc8cd7988249127fa2889f808a5777c541b2b14",class:"erx-crop",part:"container"},r("div",{key:"d7e69f3cf5695703eddd6f82768de37d5aa55e4c",class:"erx-crop__container",ref:e=>this.containerEl=e,part:"image-container"},this.src&&r("img",{key:"ec852046663d84b162520328602e65d73b9ec072",ref:e=>this.imageEl=e,src:this.src,class:"erx-crop__image",style:{transform:`scale(${this.zoom}) rotate(${this.rotation}deg)`},onLoad:()=>this.imageLoaded=!0,part:"image"}),r("div",{key:"0781f8402eb4d74909d81615a55f8d148f0b6dc9",class:"erx-crop__overlay",part:"overlay"},r("div",{key:"d54a766aaa13c2376953ba1fbec6da638815573f",class:{"erx-crop__area":!0,"erx-crop__area--circular":this.circular},style:{left:`${this.cropArea.x}%`,top:`${this.cropArea.y}%`,width:`${this.cropArea.width}%`,height:`${this.cropArea.height}%`},onMouseDown:this.handleMouseDown,part:"crop-area"},this.showGrid&&r("div",{key:"3ff8e227e67559128e424095982b43a6acc91db3",class:"erx-crop__grid"},r("div",{key:"bcb75d63cd02b94ddc97671ccb5101199f89e4c9",class:"erx-crop__grid-line erx-crop__grid-line--h1"}),r("div",{key:"6fc53acfbdfdb1767aed6c310dab882b8f6be5e8",class:"erx-crop__grid-line erx-crop__grid-line--h2"}),r("div",{key:"596decacc6dca9ab3b91c0fe377e778009f67f37",class:"erx-crop__grid-line erx-crop__grid-line--v1"}),r("div",{key:"c0de50f256dccd5c15d36e0d3442e9c53e3f1e19",class:"erx-crop__grid-line erx-crop__grid-line--v2"})),r("div",{key:"ebfcf67c67c415dfa2d97e8e1556ff98bb61b83f",class:"erx-crop__handle erx-crop__handle--nw",onMouseDown:e=>this.handleResize("nw",e)}),r("div",{key:"7b44be973c63b202b517ac8feee619ba4400f0f9",class:"erx-crop__handle erx-crop__handle--ne",onMouseDown:e=>this.handleResize("ne",e)}),r("div",{key:"3ddc0fd4f8bc6bd01c0dc4236bfaba23fff49ae1",class:"erx-crop__handle erx-crop__handle--sw",onMouseDown:e=>this.handleResize("sw",e)}),r("div",{key:"aef41110e1e7065b40c5b6b09dece4f048ec8ca3",class:"erx-crop__handle erx-crop__handle--se",onMouseDown:e=>this.handleResize("se",e)})))),r("div",{key:"305b4df36dfbd69d62c1e70d37d26f9226d0cf41",class:"erx-crop__controls",part:"controls"},r("div",{key:"c0343fd2cf15163457de0fb4b9113c3adbf8266e",class:"erx-crop__zoom"},r("span",{key:"161c3dada16118c2bd07e0538af98179d79b4682"},"ðŸ”"),r("input",{key:"4d9fca78b646f90202765a1766f3817311e12109",type:"range",min:this.minZoom,max:this.maxZoom,step:"0.1",value:this.zoom,onInput:this.handleZoomChange,class:"erx-crop__zoom-slider"}),r("span",{key:"e3a4b30e3858553bcffa1ade490275dfb03c583f"},Math.round(this.zoom*100),"%")),r("div",{key:"6cad9abd9b99ae0525f0464836a526a5e3cffbcd",class:"erx-crop__rotation"},r("button",{key:"2c3c7c97dde4cba259c92ff102178bb17738a349",class:"erx-crop__btn",onClick:()=>this.rotate(-90)},"â†º"),r("button",{key:"248dd9d311f128bd705a0a0bdfbacb0952217d51",class:"erx-crop__btn",onClick:()=>this.rotate(90)},"â†»")),r("button",{key:"1d8a65f6475c6fb7c847b138e88b39c735dd6ed2",class:"erx-crop__btn",onClick:()=>this.reset()},"Reset")))}};b.style=u();export{b as erx_image_crop};
