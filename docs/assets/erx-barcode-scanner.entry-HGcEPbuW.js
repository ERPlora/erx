import{r as i,c as s,g as o,h as r}from"./index-DLMfuaWg.js";const c=()=>":host{display:block;font-family:-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif}.erx-scanner{position:relative;background:#000;border-radius:12px;overflow:hidden}.erx-scanner__video{width:100%;height:100%;-o-object-fit:cover;object-fit:cover}.erx-scanner__canvas{display:none}.erx-scanner__overlay{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;pointer-events:none}.erx-scanner__guide{position:relative;width:70%;max-width:280px;aspect-ratio:1}.erx-scanner__corner{position:absolute;width:32px;height:32px;border-color:var(--erx-color-primary, #667eea);border-style:solid;border-width:0}.erx-scanner__corner--tl{top:0;left:0;border-top-width:4px;border-left-width:4px;border-top-left-radius:8px}.erx-scanner__corner--tr{top:0;right:0;border-top-width:4px;border-right-width:4px;border-top-right-radius:8px}.erx-scanner__corner--bl{bottom:0;left:0;border-bottom-width:4px;border-left-width:4px;border-bottom-left-radius:8px}.erx-scanner__corner--br{bottom:0;right:0;border-bottom-width:4px;border-right-width:4px;border-bottom-right-radius:8px}.erx-scanner__line{position:absolute;left:10%;right:10%;height:2px;background:var(--erx-color-primary, #667eea);box-shadow:0 0 8px var(--erx-color-primary, #667eea);animation:erx-scanner-scan 2s ease-in-out infinite}@keyframes erx-scanner-scan{0%,100%{top:10%}50%{top:90%}}.erx-scanner__placeholder{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:var(--erx-surface-secondary, #f9fafb)}.erx-scanner__start{padding:12px 24px;border:none;background:var(--erx-color-primary, #667eea);color:white;font-size:16px;font-weight:500;border-radius:8px;cursor:pointer;transition:background 150ms ease}.erx-scanner__start:hover{background:var(--erx-color-primary-dark, #5a6fd6)}.erx-scanner__error{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:16px;background:rgba(0,0,0,0.8);color:white}.erx-scanner__error button{padding:8px 16px;border:1px solid white;background:transparent;color:white;border-radius:6px;cursor:pointer}.erx-scanner__result{position:absolute;bottom:0;left:0;right:0;padding:12px 16px;background:rgba(0,0,0,0.8);color:white;display:flex;align-items:center;gap:12px}.erx-scanner__result-format{padding:4px 8px;background:var(--erx-color-primary, #667eea);border-radius:4px;font-size:11px;font-weight:600;text-transform:uppercase}.erx-scanner__result-text{flex:1;font-size:14px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}",d=class{constructor(e){i(this,e),this.erxScan=s(this,"erxScan"),this.erxError=s(this,"erxError")}get el(){return o(this)}formats=["qr_code","ean_13","ean_8","code_128"];autoStart=!1;facingMode="environment";scanInterval=500;showOverlay=!0;beepOnScan=!0;vibrateOnScan=!0;continuous=!1;width="100%";height="300px";erxScan;erxError;isScanning=!1;hasPermission=!1;lastResult;error;videoEl;canvasEl;stream;scanTimer;barcodeDetector;componentDidLoad(){this.autoStart&&this.startScanning()}disconnectedCallback(){this.stopScanning()}async startScanning(){try{this.error=void 0,"BarcodeDetector"in window&&(this.barcodeDetector=new window.BarcodeDetector({formats:this.formats})),this.stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:this.facingMode,width:{ideal:1280},height:{ideal:720}}}),this.hasPermission=!0,this.videoEl&&(this.videoEl.srcObject=this.stream,await this.videoEl.play()),this.isScanning=!0,this.startScanLoop()}catch{this.error="Camera access denied",this.erxError.emit({error:"Camera access denied",code:"PERMISSION_DENIED"})}}async stopScanning(){this.isScanning=!1,this.scanTimer&&(clearInterval(this.scanTimer),this.scanTimer=void 0),this.stream&&(this.stream.getTracks().forEach(e=>e.stop()),this.stream=void 0),this.videoEl&&(this.videoEl.srcObject=null)}async toggleTorch(e){if(!this.stream)return;const t=this.stream.getVideoTracks()[0];if(t&&"applyConstraints"in t)try{await t.applyConstraints({advanced:[{torch:e}]})}catch{console.warn("Torch not supported")}}startScanLoop(){this.scanTimer=window.setInterval(()=>{this.scanFrame()},this.scanInterval)}async scanFrame(){if(!this.isScanning||!this.videoEl||!this.canvasEl)return;const e=this.canvasEl.getContext("2d");if(e){this.canvasEl.width=this.videoEl.videoWidth,this.canvasEl.height=this.videoEl.videoHeight,e.drawImage(this.videoEl,0,0);try{if(this.barcodeDetector&&"detect"in this.barcodeDetector){const a=await this.barcodeDetector.detect(this.canvasEl);if(a.length>0){const n=a[0];this.handleScanResult({text:n.rawValue,format:n.format,timestamp:new Date,rawValue:n.rawValue})}}}catch{}}}handleScanResult(e){this.lastResult?.text===e.text&&Date.now()-this.lastResult.timestamp.getTime()<2e3||(this.lastResult=e,this.beepOnScan&&this.playBeep(),this.vibrateOnScan&&"vibrate"in navigator&&navigator.vibrate(100),this.erxScan.emit({result:e}),this.continuous||this.stopScanning())}playBeep(){const e=new(window.AudioContext||window.webkitAudioContext),t=e.createOscillator(),a=e.createGain();t.connect(a),a.connect(e.destination),t.frequency.value=1e3,t.type="sine",a.gain.value=.1,t.start(),t.stop(e.currentTime+.1)}render(){return r("div",{key:"3ca33bfa4090f3939d8768aa886bb298c848df9c",class:"erx-scanner",style:{width:this.width,height:this.height},part:"container"},r("video",{key:"54371d66c25d635491c8acf10b6419f9d44191f8",ref:e=>this.videoEl=e,class:"erx-scanner__video",playsinline:!0,muted:!0,part:"video"}),r("canvas",{key:"339fbc2e29718caff97dd15dff49f7aadc696230",ref:e=>this.canvasEl=e,class:"erx-scanner__canvas"}),this.showOverlay&&this.isScanning&&r("div",{key:"0f3689a12b2c715875815053ef23d9f1a4741fef",class:"erx-scanner__overlay",part:"overlay"},r("div",{key:"f4a72e4fa4b56ba86af5ce72c57d31990e7121ea",class:"erx-scanner__guide",part:"guide"},r("div",{key:"ff2024a2a13b52ed84e3373cce7d04f2571bd2a0",class:"erx-scanner__corner erx-scanner__corner--tl"}),r("div",{key:"91b84237476061497d9f58463ea3fcc97f24a66d",class:"erx-scanner__corner erx-scanner__corner--tr"}),r("div",{key:"d66596db8ba83b231766b32ec3158de7e59e84e0",class:"erx-scanner__corner erx-scanner__corner--bl"}),r("div",{key:"e0935fd3e9b893e3ea5abb1636308e5076ab2142",class:"erx-scanner__corner erx-scanner__corner--br"}),r("div",{key:"7c8b9c6b22db38a86cf5d18d73d6ff352424d4e9",class:"erx-scanner__line"}))),!this.isScanning&&!this.error&&r("div",{key:"cda9a6ab5152cc5be8c4ea77dcc5370c431735fa",class:"erx-scanner__placeholder",part:"placeholder"},r("button",{key:"c1610127c7fe116720c47810d20d72e271055712",class:"erx-scanner__start",onClick:()=>this.startScanning()},"ðŸ“· Start Scanner")),this.error&&r("div",{key:"748fc2e4b406e432e802e6b56a4ee938daa7aa8d",class:"erx-scanner__error",part:"error"},r("span",{key:"c591fdfbb092a026e4db45dd32a957fcd961adc4"},"âš ï¸ ",this.error),r("button",{key:"54d51534ecd28be4bc4262cc4978fa9d3f1f723f",onClick:()=>this.startScanning()},"Try Again")),this.lastResult&&r("div",{key:"1561b06a5ac347accb772fdb82376b444e07110f",class:"erx-scanner__result",part:"result"},r("span",{key:"0b3dd11b095f86cb92345add35a549e1d8a56a12",class:"erx-scanner__result-format"},this.lastResult.format),r("span",{key:"87663f555b74c2c18baafdfd9733389f42eb9100",class:"erx-scanner__result-text"},this.lastResult.text)))}};d.style=c();export{d as erx_barcode_scanner};
