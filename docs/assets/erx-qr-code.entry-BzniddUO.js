import{r as l,g as h,h as n}from"./index-DLMfuaWg.js";const d=()=>":host{display:inline-block}.erx-qr{position:relative;line-height:0}.erx-qr__canvas{display:block;border-radius:8px}.erx-qr__empty{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:var(--erx-surface-secondary, #f9fafb);border-radius:8px;color:var(--erx-text-tertiary, #9ca3af);font-size:14px;font-family:-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif}",c=class{constructor(e){l(this,e)}get el(){return h(this)}value="";size=200;errorLevel="M";color="#000000";backgroundColor="#ffffff";margin=4;logo;logoSize=.2;modules=[];canvasEl;handleValueChange(){this.generateQRCode()}componentWillLoad(){this.generateQRCode()}componentDidLoad(){this.renderCanvas()}componentDidUpdate(){this.renderCanvas()}async toDataURL(){return this.canvasEl?.toDataURL("image/png")||""}async download(e="qrcode.png"){const t=await this.toDataURL(),i=document.createElement("a");i.download=e,i.href=t,i.click()}generateQRCode(){if(!this.value){this.modules=[];return}const e=this.calculateSize();this.modules=this.createQRMatrix(this.value,e)}calculateSize(){const e=this.value.length;return e<=25?21:e<=47?25:e<=77?29:e<=114?33:37}createQRMatrix(e,t){const i=[];for(let r=0;r<t;r++){i[r]=[];for(let s=0;s<t;s++)if(this.isFinderPattern(r,s,t))i[r][s]=!0;else if(this.isTimingPattern(r,s,t))i[r][s]=(r+s)%2===0;else{const a=this.simpleHash(e,r,s);i[r][s]=a%2===0}}return i}isFinderPattern(e,t,i){return e<7&&t<7?this.isInFinderModule(e,t):e<7&&t>=i-7?this.isInFinderModule(e,t-(i-7)):e>=i-7&&t<7?this.isInFinderModule(e-(i-7),t):!1}isInFinderModule(e,t){return e===0||e===6||t===0||t===6||e>=2&&e<=4&&t>=2&&t<=4}isTimingPattern(e,t,i){return e===6&&t>7&&t<i-8||t===6&&e>7&&e<i-8}simpleHash(e,t,i){let r=0;const s=e+t.toString()+i.toString();for(let a=0;a<s.length;a++)r=(r<<5)-r+s.charCodeAt(a),r=r&r;return Math.abs(r)}renderCanvas(){if(!this.canvasEl||this.modules.length===0)return;const e=this.canvasEl.getContext("2d");if(!e)return;const t=this.modules.length,i=(this.size-this.margin*2)/t;e.fillStyle=this.backgroundColor,e.fillRect(0,0,this.size,this.size),e.fillStyle=this.color;for(let r=0;r<t;r++)for(let s=0;s<t;s++)this.modules[r][s]&&e.fillRect(this.margin+s*i,this.margin+r*i,i,i);if(this.logo){const r=new Image;r.crossOrigin="anonymous",r.onload=()=>{const s=this.size*this.logoSize,a=(this.size-s)/2,o=(this.size-s)/2;e.fillStyle=this.backgroundColor,e.fillRect(a-4,o-4,s+8,s+8),e.drawImage(r,a,o,s,s)},r.src=this.logo}}render(){return n("div",{key:"721fe93136a8686709ef2a7d043821a346fe0d20",class:"erx-qr",part:"container"},n("canvas",{key:"59ea9b4464cd17f43adb3aca35270211b3b94fcf",ref:e=>this.canvasEl=e,width:this.size,height:this.size,class:"erx-qr__canvas",part:"canvas"}),!this.value&&n("div",{key:"c8b372d128bd575fd01455600054657f25a35dfe",class:"erx-qr__empty"},"No data"))}static get watchers(){return{value:[{handleValueChange:0}],errorLevel:[{handleValueChange:0}]}}};c.style=d();export{c as erx_qr_code};
